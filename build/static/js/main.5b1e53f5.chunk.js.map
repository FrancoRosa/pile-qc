{"version":3,"sources":["api.js","FileInput.jsx","App.jsx","model.js","index.js"],"names":["uploadFile","file","epsg","a","console","log","url","formData","FormData","append","axios","post","headers","response","data","message","points","length","FileInput","useState","path","setPath","name","setName","fileStatus","setFileStatus","loading","setLoading","setPoints","useStoreActions","actions","useStoreState","state","setFile","useEffect","document","querySelector","addEventListener","e","localPath","target","files","localName","className","type","accept","onClick","then","res","catch","colorsFill","App","showInfo","setShowInfo","showUpload","setShowUpload","relatedPoints","setRelatedPoints","INITIAL_VIEW_STATE","longitude","lng_field","latitude","lat_field","zoom","maxZoom","pitch","bearing","initialViewState","controller","getTooltip","object","order","pile_id","angle_g_error","x_g_error","y_g_error","mapboxApiAccessToken","diskResolution","radius","extruded","pickable","elevationScale","getPosition","d","getFillColor","point","get_color","getLineColor","getElevation","z_field","z_design","upperEdge","filter","p","lowerEdge","lng_design","lat_design","wireframe","lineWidthMaxPixels","lineWidthMinPixels","getRadius","getColor","filled","stroked","opacity","y_design","x_design","classList","add","setTimeout","getSavedStorage","key","JSON","parse","window","localStorage","getItem","initial","setSavedStorage","obj","setItem","stringify","action","store","createStore","model","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5b1e53f5.chunk.js","sourcesContent":["import axios from \"axios\";\n\n// const host = \"localhost:10000\";\nconst host = \"161.35.178.247:10000\";\n\nexport const uploadFile = async (file, epsg) => {\n  console.log(\"... uploading file\");\n  const url = `http://${host}/api/file`;\n  let formData = new FormData();\n  formData.append(\"file\", file);\n  formData.append(\"code\", epsg);\n  const response = await axios.post(url, formData, {\n    headers: {\n      \"Content-Type\": \"multipart/form-data\",\n    },\n  });\n  console.log(response.data.message);\n  console.log(response.data.points.length);\n  return response.data;\n};\n","import { useStoreActions, useStoreState } from \"easy-peasy\";\nimport { useEffect, useState } from \"react\";\nimport { uploadFile } from \"./api\";\n\nconst FileInput = () => {\n  const [path, setPath] = useState(\"\");\n  const [name, setName] = useState(\"Nothing selected yet\");\n  const [fileStatus, setFileStatus] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  const setPoints = useStoreActions((actions) => actions.setPoints);\n  const points = useStoreState((state) => state.points);\n  const setFile = useStoreActions((actions) => actions.setFile);\n\n  useEffect(() => {\n    const handleFiles = (e) => {\n      let localPath = e.target.files[0];\n      let localName = e.target.files[0].name;\n      setPath(localPath);\n      setName(localName);\n    };\n\n    const inputElement = document.querySelector(\".file-input\");\n    inputElement.addEventListener(\"change\", handleFiles, false);\n  }, []);\n\n  const handleFiles = (file) => {\n    setFileStatus(null);\n    setLoading(true);\n    uploadFile(file)\n      .then((res) => {\n        setFileStatus(res.message);\n        setPoints(res.points);\n        setLoading(false);\n        setFile(name);\n      })\n      .catch(() => {\n        setFileStatus(false);\n        setPoints([]);\n        setLoading(false);\n      });\n  };\n\n  return (\n    <div className=\"columns\">\n      <div className=\"column file has-name\">\n        <label className=\"file-label\">\n          <input className=\"file-input\" type=\"file\" accept=\".csv, .xlsx\" />\n        </label>\n      </div>\n      <div className=\"column\">\n        {path ? (\n          <div className=\"is-flex is-justify-content-center\">\n            <button\n              className=\"button is-outlined is-success\"\n              onClick={() => handleFiles(path)}\n            >\n              Upload\n            </button>\n          </div>\n        ) : (\n          \"\"\n        )}\n      </div>\n      <div className=\"column\">\n        {loading && (\n          <p className=\"animate__animated animate__zoomIn animate__infinite\">\n            ... Processing{\" \"}\n          </p>\n        )}\n        {fileStatus ? (\n          <div className=\"is-flex is-align-content-center is-flex-direction-column\">\n            <p className={fileStatus ? \"has-text-success\" : \"has-text-fail\"}>\n              {fileStatus ? \"Success\" : \"Fail\"}\n            </p>\n            <p>Piles found: {points.length}</p>\n          </div>\n        ) : (\n          \"\"\n        )}\n      </div>\n      <br />\n    </div>\n  );\n};\n\nexport default FileInput;\n","import { DeckGL } from \"@deck.gl/react\";\nimport { NavigationControl, StaticMap } from \"react-map-gl\";\nimport { ColumnLayer, ScatterplotLayer } from \"@deck.gl/layers\";\n// import points from \"./result.json\";\nimport { useState } from \"react\";\nimport FileInput from \"./FileInput\";\nimport { useStoreState } from \"easy-peasy\";\n\nconst MAPBOX_ACCESS_TOKEN =\n  \"pk.eyJ1Ijoia20xMTVmcmFuY28iLCJhIjoiY2t0eXQ3cHBhMGI3aTMxcG14dnN0OHJveSJ9.LWxkBiVPF9UfGWMI4sWakQ\";\n\nconst colors = {\n  black: [0, 0, 0],\n  blue: [0, 0, 255],\n  brown: [165, 42, 42],\n  darkblue: [0, 0, 139],\n  green: [0, 255, 0],\n  lightblue: [135, 206, 235],\n  lightgreen: [144, 238, 144],\n  orange: [255, 165, 0],\n  pink: [255, 105, 180],\n  purple: [128, 0, 128],\n  red: [255, 0, 0],\n  white: [255, 255, 255],\n  yellow: [255, 255, 0],\n};\n\nconst colorsFill = {\n  black: [0, 0, 0, 128],\n  blue: [0, 0, 255, 128],\n  brown: [165, 42, 42, 128],\n  darkblue: [0, 0, 139, 128],\n  green: [0, 255, 0, 128],\n  lightblue: [135, 206, 235, 128],\n  lightgreen: [144, 238, 144, 128],\n  orange: [255, 165, 0, 128],\n  pink: [255, 105, 180, 128],\n  purple: [128, 0, 128, 128],\n  red: [255, 0, 0, 128],\n  white: [255, 255, 255, 128],\n  yellow: [255, 255, 0, 128],\n};\n\nconst get_color = (point) => {\n  if (\"angle_g_error\" in point) {\n    const { angle_g_error, x_g_error, y_g_error } = point;\n    const angle_th = 0.69;\n    const x_th = 0.25;\n    const y_th = 0.5;\n    if (angle_g_error > angle_th) {\n      return colorsFill.pink;\n    }\n    if (x_g_error > x_th) {\n      return colorsFill.orange;\n    }\n    if (y_g_error[0] > y_th || y_g_error[1] > y_th) {\n      return colorsFill.red;\n    }\n    return colorsFill.lightgreen;\n  } else {\n    return colorsFill.lightblue;\n  }\n};\n\nconst App = () => {\n  const [showInfo, setShowInfo] = useState(false);\n  const [showUpload, setShowUpload] = useState(false);\n  const [relatedPoints, setRelatedPoints] = useState([]);\n\n  const points = useStoreState((state) => state.points);\n  const file = useStoreState((state) => state.file);\n\n  const INITIAL_VIEW_STATE = {\n    longitude: points.length > 3 ? points[3].lng_field : -93,\n    latitude: points.length > 3 ? points[3].lat_field : 40,\n    zoom: 21,\n    maxZoom: 25,\n    pitch: 60,\n    bearing: 0,\n  };\n\n  const handlePileClick = (d) => {\n    const { order } = d.object;\n\n    const upperEdge = points.filter(\n      (p) => p.order[0] === order[0] && p.order[1] === order[1] - 1\n    )[0];\n    const lowerEdge = points.filter(\n      (p) => p.order[0] === order[0] && p.order[1] === order[1] + 1\n    )[0];\n\n    setRelatedPoints([upperEdge, d.object, lowerEdge]);\n    setShowInfo(true);\n  };\n\n  const handleCloseButton = () => {\n    document.querySelector(\".details\").classList.add(\"animate__fadeOutRight\");\n    setTimeout(() => {\n      setShowInfo(false);\n      setRelatedPoints([]);\n    }, 1000);\n  };\n\n  const handleCloseUpload = () => {\n    setShowUpload(false);\n  };\n\n  return (\n    <>\n      <DeckGL\n        initialViewState={INITIAL_VIEW_STATE}\n        controller={true}\n        getTooltip={({ object }) =>\n          object &&\n          `Order: [${object.order}]\n          Code: ${object.pile_id}\\n\\\n          angle: ${object.angle_g_error}\\n\\\n          Xdiff: ${object.x_g_error}\\n\\\n          Ydiff: ${object.y_g_error}`\n        }\n      >\n        <StaticMap mapboxApiAccessToken={MAPBOX_ACCESS_TOKEN}>\n          <NavigationControl />\n        </StaticMap>\n        <ColumnLayer\n          data={points}\n          diskResolution={6}\n          radius={0.2}\n          extruded={true}\n          pickable={true}\n          elevationScale={1}\n          getPosition={(d) => [d.lng_field, d.lat_field]}\n          getFillColor={(d) => get_color(d)}\n          getLineColor={[0, 0, 0]}\n          getElevation={(d) => 2 + d.z_field - d.z_design}\n          onClick={handlePileClick}\n        />\n\n        <ColumnLayer\n          data={points}\n          diskResolution={6}\n          radius={0.2}\n          extruded={true}\n          elevationScale={1}\n          getPosition={(d) => [d.lng_design, d.lat_design]}\n          getFillColor={[0, 30, 0, 30]}\n          getLineColor={[10, 10, 10, 30]}\n          getElevation={2}\n          wireframe\n        />\n        {showInfo && (\n          <ScatterplotLayer\n            lineWidthMaxPixels={3}\n            lineWidthMinPixels={2}\n            getRadius={3}\n            data={relatedPoints}\n            getPosition={(d) => [d.lng_design, d.lat_design]}\n            getColor={[10, 10, 10, 30]}\n            getFillColor={[10, 10, 10, 30]}\n            getLineColor={[10, 10, 10, 30]}\n            filled={true}\n            stroked={true}\n            opacity={0.8}\n          />\n        )}\n      </DeckGL>\n      {showInfo && (\n        <div className=\"details card animate__animated animate__fadeInRight\">\n          <h1>Target pile:</h1>\n          <p>Pile id: {relatedPoints[1].pile_id}</p>\n          <p>N design: {relatedPoints[1].y_design}</p>\n          <p>E design: {relatedPoints[1].x_design}</p>\n          <p>Lat design: {relatedPoints[1].lat_design}</p>\n          <p>Lng design: {relatedPoints[1].lng_design}</p>\n          <hr />\n          <p\n            className={relatedPoints[1].angle_g_error < 0.69 ? \"green\" : \"red\"}\n          >\n            Angle error: {relatedPoints[1].angle_g_error}\n          </p>\n          <p className={relatedPoints[1].x_g_error < 0.25 ? \"green\" : \"red\"}>\n            Easting error: {relatedPoints[1].x_g_error}\n          </p>\n          <p\n            className={\n              relatedPoints[1].y_g_error[0] < 0.25 ||\n              relatedPoints[1].y_g_error[1] < 0.25\n                ? \"green\"\n                : \"red\"\n            }\n          >\n            Northing error: {relatedPoints[1].y_g_error[0]},{\" \"}\n            {relatedPoints[1].y_g_error[0]}\n          </p>\n          <button className=\"button\" onClick={handleCloseButton}>\n            Close\n          </button>\n        </div>\n      )}\n      {showUpload && (\n        <div className=\"upload animate__animated animate__fadeInLeft\">\n          <h1>Upload file</h1>\n          <FileInput />\n          <hr />\n          {file && <p>Current file: {file}</p>}\n          <hr />\n          <button className=\"button\" onClick={handleCloseUpload}>\n            Close\n          </button>\n        </div>\n      )}\n      {!showUpload && (\n        <div className=\"upload animate__animated animate__fadeInLeft\">\n          <button onClick={() => setShowUpload(true)}>Upload</button>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default App;\n","import { action } from \"easy-peasy\";\n\nconst getSavedStorage = (key) => {\n  return JSON.parse(window.localStorage.getItem(key)) || initial[key];\n};\n\nconst setSavedStorage = (key, obj) => {\n  window.localStorage.setItem(key, JSON.stringify(obj));\n};\n\nconst initial = {\n  points: [],\n  file: \"\",\n};\n\nexport default {\n  points: getSavedStorage(\"points\"),\n  setPoints: action((state, points) => {\n    state.points = [...points];\n    setSavedStorage(\"points\", points);\n  }),\n  file: getSavedStorage(\"file\"),\n  setFile: action((state, file) => {\n    state.file = [...file];\n    setSavedStorage(\"file\", file);\n  }),\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport \"animate.css\";\nimport { StoreProvider, createStore } from \"easy-peasy\";\nimport App from \"./App\";\nimport model from \"./model\";\n\nconst store = createStore(model);\n\nReactDOM.render(\n  <React.StrictMode>\n    <StoreProvider store={store}>\n      <App />\n    </StoreProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}